<!DOCTYPE html>
<html>
<head>
    <title>Goals</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="font-sans m-5">
    <div class="flex justify-between items-center p-2.5 bg-gray-100 rounded-md">
        <h1 class="text-2xl font-bold">Goals</h1>
        <a href="/" class="bg-gray-600 text-white px-4 py-2 rounded no-underline hover:bg-gray-800">Back</a>
    </div>

    <h2 class="text-xl font-semibold mt-5">Set a New Goal</h2>
    <form method="POST">
        <input type="text" name="title" placeholder="Goal title" required
        class="m-1.5 px-1.5 py-1.5 rounded border border-gray-300">
        <input type="number" step="any" name="calories" placeholder="Calories goal"
        class="m-1.5 px-1.5 py-1.5 rounded border border-gray-300">
        <input type="number" step="any" name="protein" placeholder="Protein (g)"
        class="m-1.5 px-1.5 py-1.5 rounded border border-gray-300">
        <input type="number" step="any" name="carbs" placeholder="Carbs (g)"
        class="m-1.5 px-1.5 py-1.5 rounded border border-gray-300">
        <input type="number" step="any" name="fats" placeholder="Fats (g)"
        class="m-1.5 px-1.5 py-1.5 rounded border border-gray-300">
        <button type="submit" 
        class="px-3 py-1.5 border-0 rounded cursor-pointer bg-green-600 text-white hover:bg-green-700">Add Goal</button>
    </form>

    <form method="POST">
        <button type="submit" name="reset" value="1" class="px-3 py-1.5 border-0 rounded cursor-pointer bg-red-600 text-white mt-2.5 hover:bg-red-700">Reset All Goals</button>
    </form>

    <div class="mt-5">
        <h2 class="text-xl font-semibold">Current Goals</h2>
        {% for g in goals %}
        <div class="bg-gray-50 p-2.5 my-2.5 rounded-lg shadow-sm">
            <h3>{{ g['title'] }}</h3>

<label class="block font-semibold mt-2">Calories</label>
<div class="bg-gray-300 rounded-lg overflow-hidden mt-1">
    {% set cals_goal = g['calories']|float %}
    {% set cals_progress = g['progress']['calories']|float %}
    {% set cals_percent = (cals_progress / cals_goal * 100) if cals_goal else 0 %}
    <div class="bg-green-500 h-5 text-center text-white text-xs leading-5" style="width: {{ "%.2f"|format(cals_percent) }}%;">
        {{ cals_progress }}/{{ cals_goal }}
    </div>
</div>

<label class="block font-semibold mt-2">Protein</label>
<div class="bg-gray-300 rounded-lg overflow-hidden mt-1">
    {% set p_goal = g['protein']|float %}
    {% set p_progress = g['progress']['protein']|float %}
    {% set p_percent = (p_progress / p_goal * 100) if p_goal else 0 %}
    <div class="bg-green-500 h-5 text-center text-white text-xs leading-5" style="width: {{ "%.2f"|format(p_percent) }}%;">
        {{ p_progress }}/{{ p_goal }}
    </div>
</div>

<label class="block font-semibold mt-2">Carbs</label>
<div class="bg-gray-300 rounded-lg overflow-hidden mt-1">
    {% set c_goal = g['carbs']|float %}
    {% set c_progress = g['progress']['carbs']|float %}
    {% set c_percent = (c_progress / c_goal * 100) if c_goal else 0 %}
    <div class="bg-green-500 h-5 text-center text-white text-xs leading-5" style="width: {{ "%.2f"|format(c_percent) }}%;">
        {{ c_progress }}/{{ c_goal }}
    </div>
</div>

<label class="block font-semibold mt-2">Fats</label>
<div class="bg-gray-300 rounded-lg overflow-hidden mt-1">
    {% set f_goal = g['fats']|float %}
    {% set f_progress = g['progress']['fats']|float %}
    {% set f_percent = (f_progress / f_goal * 100) if f_goal else 0 %}
    <div class="bg-green-500 h-5 text-center text-white text-xs leading-5" style="width: {{ "%.2f"|format(f_percent) }}%;">
        {{ f_progress }}/{{ f_goal }}
    </div>
</div>

        </div>
        {% endfor %}

        <div class="mt-10">
            <h2 class="text-xl font-semibold">Recipes Added to Goals</h2>
            <div class="grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-4 mt-4">
                {% for r in goal_recipes %}
                <div class="bg-white shadow rounded-lg p-4 border">
                    <h3 class="text-lg font-semibold text-blue-700">{{ r['title'] }}</h3>
                    {% if r['cuisine'] %}<p class="text-sm text-gray-600 mb-1"><strong>Cuisine:</strong> {{ r['cuisine'] }}</p>{% endif %}
                    {% if r['ingredients'] %}<p class="text-sm text-gray-600 mb-1"><strong>Ingredients:</strong> {{ r['ingredients'] }}</p>{% endif %}
                    <div class="text-xs text-gray-700 space-x-1">
                        {% if r['cals'] %}<span>{{ r['cals'] }} cal</span>{% endif %}
                        {% if r['protein'] %}<span>{{ r['protein'] }}g protein</span>{% endif %}
                        {% if r['carbs'] %}<span>{{ r['carbs'] }}g carbs</span>{% endif %}
                        {% if r['fats'] %}<span>{{ r['fats'] }}g fats</span>{% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</body>
</html>

